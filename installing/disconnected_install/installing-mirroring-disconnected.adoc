:_mod-docs-content-type: ASSEMBLY
[id="installing-mirroring-disconnected_{context}"]
= Mirroring images for a disconnected installation using the oc-mirror plugin v1
include::_attributes/common-attributes.adoc[]
:context: installing-mirroring-disconnected

toc::[]

You can run your cluster in a restricted network without direct internet connectivity if you install the cluster from a mirrored set of OpenShift Container Platform container images in a private registry. This registry must be running whenever your cluster is running.

// About the oc-mirror plugin
include::modules/oc-mirror-about.adoc[leveloffset=+1]

// oc-mirror compatibility and support
include::modules/oc-mirror-support.adoc[leveloffset=+1]

[id="prerequisites_installing-mirroring-disconnected_{context}"]
== Prerequisites to using the oc-mirror plugin v1

* You must have a container image registry, that supports link:https://docs.docker.com/registry/spec/manifest-v2-2[Docker v2-2] in the location that hosts the {product-title} cluster, such as {quay}. The container image registry is also called the mirror registry.
+
[NOTE]
====
If you use {quay}, use version 3.6 or later with the oc-mirror plugin. If you have an entitlement to {quay}, see the documentation on deploying {quay} link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/deploy_red_hat_quay_for_proof-of-concept_non-production_purposes/[for proof-of-concept purposes] or link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/deploying_the_red_hat_quay_operator_on_openshift_container_platform/index[by using the Red Hat Quay Operator]. If you need additional assistance selecting and installing a registry, contact your sales representative or Red Hat Support.
====
+
If you do not already have an existing solution for a mirror registry, receive a mirror registry for Red Hat OpenShift. This mirror registry is included with your subscription and serves as a small-scale container registry. You can use this registry to mirror the necessary container images of OpenShift Container Platform for disconnected installations.

* Every machine in the provisioned clusters must have access to the mirror registry. If the registry is unreachable, installation, updating, or normal operations such as workload relocation might fail. For this reason, you must run mirror registries in a highly available manner. The mirror registries must meet or exceed the production availability of your {product-title} clusters.

* You have set the umask parameter to `0022` on the operating system that uses oc-mirror plugin v1.

[role="_additional-resources"]
.Additional resources

* xref:../../installing/disconnected_install/installing-mirroring-creating-registry.adoc#installing-mirroring-creating-registry[Creating a mirror registry with mirror registry for Red Hat OpenShift]

[id="mirroring-preparing-your-hosts_{context}"]
== Preparing your mirror hosts

Before you can use the oc-mirror plugin v1 to mirror images, you must install the plugin. You must also create a container image registry credentials file to enable mirroring from Red Hat to your mirror.

// Installing the oc-mirror OpenShift CLI plugin v1
include::modules/oc-mirror-installing-plugin.adoc[leveloffset=+2]

// Configuring credentials that allow images to be mirrored
include::modules/installation-adding-registry-pull-secret.adoc[leveloffset=+2]

// About Image set configuration
include::modules/oc-mirror-about-image-set-config.adoc[leveloffset=+1]

// Creating the image set configuration
include::modules/oc-mirror-creating-image-set-config.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources

* xref:../../installing/disconnected_install/modules/installation-adding-registry-pull-secret.adoc#installation-adding-registry-pull-secret[Configuring credentials that allow images to be mirrored]

// Image set configuration parameters
include::modules/oc-mirror-imageset-config-params.adoc[leveloffset=+2]

// Image set configuration examples
include::modules/oc-mirror-image-set-config-examples.adoc[leveloffset=+2]

// Setting up for incremental mirroring
include::modules/oc-mirror-setting-incremental-mirroring.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../../updating/updating_a_cluster/updating_disconnected_cluster/disconnected-update-osus.adoc#update-service-overview_updating-restricted-network-cluster-osus[Updating a cluster in a disconnected environment using the OpenShift Update Service]

* xref:../../cli_reference/openshift_cli/extending-cli-plugins.adoc#cli-installing-plugins_cli-extend-plugins[Extending the OpenShift CLI with plugins]

// Mirroring an image set to a mirror registry
include::modules/oc-mirror-mirroring-image-set.adoc[leveloffset=+1]

// Mirroring from partially disconnected environment:mirror to mirror
include::modules/oc-mirror-mirror-to-mirror.adoc[leveloffset=+2]

// Mirroring from fully disconnected environment
include::modules/oc-mirror-fully-disconnected.adoc[leveloffset=+2]

// Mirroring from mirror to disk
include::modules/oc-mirror-mirror-to-disk.adoc[leveloffset=+3]

// Mirroring from disk to mirror in a disconnected environment
include::modules/oc-mirror-disk-to-mirror.adoc[leveloffset=+3]

// Configuring your cluster to use the resources generated by oc-mirror
include::modules/oc-mirror-updating-cluster-manifests.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../../updating/understanding_updates/intro-to-updates.adoc#update-service-about_understanding-openshift-updates[About the OpenShift Update Service]

// About updating your mirror registry content
include::modules/oc-mirror-updating-registry-about.adoc[leveloffset=+1]

// Use-cases
include::modules/oc-mirror-updating-use-cases.adoc[leveloffset=+2]

// Performing a dry run
include::modules/oc-mirror-dry-run.adoc[leveloffset=+1]

// Including local OCI Operator catalogs
include::modules/oc-mirror-oci-format.adoc[leveloffset=+1]

// Additional resources

// TODO: This title might need to update per sebastian's PR
// Configuring your cluster to use the resources generated by oc-mirror

// Command reference for oc-mirror
include::modules/oc-mirror-command-reference.adoc[leveloffset=+1]

[role="_additional-resources"]
== Additional resources

* xref:../../updating/updating_a_cluster/updating_disconnected_cluster/index.adoc#about-restricted-network-updates[About cluster updates in a disconnected environment]

* xref:../../installing/validating-an-installation.adoc#viewing-the-image-pull-source_validating-an-installation[Viewing the image pull source]

//Module included in the following assemblies:
//
// * installing/installing_azure/enabling-disk-encryption-sets-azure.adoc

:_mod-docs-content-type: PROCEDURE
[id="preparing-disk-encryption-sets-day2-operator"]
= Preparing an Azure Disk Encryption Set for Day2 operator
The {product-title} installer can use an existing Disk Encryption Set with a user-managed key. To enable this feature, you can create a Disk Encryption Set in Azure and provide the key to the installer. 

.Prerequisite

To enable encryption at host by using system managed key during the installation, set the following fields in `install-config.yaml`:

* `compute.platform.azure.encryptionAtHost`
* `controlPlane.platform.azure.encryptionAtHost`
* `platform.azure.defaultMachinePlatform.encryptionAtHost`

.Procedure

. Mark the node from the `encyptionATHost` cluster resource group as unschedulable using the following command:
+
[source,terminal]
----
$ oc adm cordon <node_name>
----

. De-allocate the node using the following command:
+
[source,terminal]
----
$ az vm deallocate -n <node_name> -g <cluster_resource_group>
----

. Set the `encryptionAtHost` property to `true` using the following command:
+
[source,terminal]
----
$ az vm update -n <node_name> -g <cluster_resource_group> --set securityProfile.encryptionAtHost=true
----

. Start the node by running the following commands:
+
[source,terminal]
----
$ az vm start -n <node_name> -g <cluster_resource_group>
----

. Mark the node as schedulable using the follwoing command:
+
[source,terminal]
----
$ oc adm uncordon <node_name>
----

. Make sure that all the operators are available.

. Repeat the above steps on all the nodes of the `encryptionAtHost`.
